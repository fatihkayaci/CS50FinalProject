{% extends "admin/adminlayout.html" %}
{% block main %}
<div class="container mt-4">
    <ul class="nav nav-tabs" id="settingsTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="main-tab" data-bs-toggle="tab" data-bs-target="#main" type="button"
                role="tab" aria-controls="main" aria-selected="true">Ana Sayfa</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="services-tab" data-bs-toggle="tab" data-bs-target="#services" type="button"
                role="tab" aria-controls="services" aria-selected="false">Hizmetler Sayfa</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="archive-tab" data-bs-toggle="tab" data-bs-target="#archive" type="button"
                role="tab" aria-controls="archive" aria-selected="false">Arşiv Sayfa</button>
        </li>
    </ul>
    <div class="tab-content mt-3" id="settingsTabContent">
        <div class="tab-pane fade show active" id="main" role="tabpanel" aria-labelledby="main-tab">
            {% for title, items in grouped_by_page['mainpage'].items() %}
                <div class="container-fluid border mb-3">
                    <h3>{{ title }}</h3>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">Label</th>
                                <th scope="col">Text Message</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in items %}
                                {% if item.label != '' %}
                                    <tr>
                                        <td>{{ item.label }}</td>
                                        <td>{{ item.text_message }}</td>
                                        <td><a href="/updatetextandmedia/{{ item.id }}" class="btn btn-sm btn-primary"><i class="fa fa-pencil"></i> Düzenle</a></td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                    <!-- Resimleri div'in altına ekleme -->
                    <div class="text-center mt-3">
                        {% for item in items %}
                            {% if item.image_path %}
                                <img src="{{ item.image_path }}" alt="Image" class="img-fluid m-2" onclick="showPopup()" style="max-width: 200px;">
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>

        <div class="tab-pane fade" id="services" role="tabpanel" aria-labelledby="services-tab">
            {% for title, items in grouped_by_page['servicespage'].items() %}
                <div class="container-fluid border mb-3">
                    <h3>{{ title }}</h3>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">Label</th>
                                <th scope="col">Text Message</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in items %}
                                {% if item.label != '' %}
                                    <tr>
                                        <td>{{ item.label }}</td>
                                        <td>{{ item.text_message }}</td>
                                        <td><a href="/updatetextandmedia/{{ item.id }}" class="btn btn-sm btn-primary"><i class="fa fa-pencil"></i> Düzenle</a></td>
                                    </tr>    
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                    <!-- Resimleri div'in altına ekleme -->
                    <div class="text-center mt-3">
                        {% for item in items %}
                            {% if item.image_path %}
                                <img src="{{ item.image_path }}" alt="Image" class="img-fluid m-2" onclick="showPopup()" style="max-width: 200px;">
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <div class="tab-pane fade" id="archive" role="tabpanel" aria-labelledby="archive-tab">
            {% for title, items in grouped_by_page['archivepage'].items() %}
                <div class="container-fluid border mb-3">
                    <h3>{{ title }}</h3>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">Label</th>
                                <th scope="col">Text Message</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in items %}
                                {% if item.label != '' %}
                                    <tr>
                                        <td>{{ item.label }}</td>
                                        <td>{{ item.text_message }}</td>
                                        <td><a href="/updatetextandmedia/{{ item.id }}" class="btn btn-sm btn-primary"><i class="fa fa-pencil"></i> Düzenle</a></td>
                                    </tr>    
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                    <!-- Resimleri div'in altına ekleme -->
                    <div class="text-center mt-3">
                        {% for item in items %}
                            {% if item.image_path %}
                                <img src="{{ item.image_path }}" alt="Image" class="img-fluid m-2" onclick="showPopup()" style="max-width: 200px;">
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="popup-background" id="popup" style="display: none;">
    <div class="popup-content">
        <button class="close-btn kapat" id="closePopup"><h3>X</h3></button>
        <div>
            <h3>Media Seç</h3>
        </div>
        <div>
            <table>
                <tr>
                    <th><p>dosyadan seçme</p></th>
                    <th><p>bilgisayardan seçme</p></th>
                </tr>
                <tbody>
                    <td>
                        <select name="" id="imageSelect">
                            <option selected disabled></option>
                            {% for image in all_images %}
                                {% if image: %}
                                    <option value="{{image}}">{{image}}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <input type="file" id="imageInput" accept="image/*">
                    </td>
                </tbody>
            </table>
        </div>
        <div>
            <button class="guncelle-btn" onclick="updateMedia(filename = 'foods')">Güncelle</button>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="../../static/js/popup.js"></script>
<script src="../../static/js/updatemedia.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const tabs = document.querySelectorAll("#settingsTab .nav-link");
        const tabPanes = document.querySelectorAll(".tab-pane");

        tabs.forEach(tab => {
            tab.addEventListener("click", function (e) {
                e.preventDefault();

                // Tüm sekmeleri pasif hale getir
                tabs.forEach(t => t.classList.remove("active"));
                tabPanes.forEach(pane => pane.classList.remove("show", "active"));

                // Seçilen sekmeyi aktif hale getir
                this.classList.add("active");
                const targetPane = document.querySelector(this.dataset.bsTarget);
                targetPane.classList.add("show", "active");
            });
        });
    });
</script>
{% endblock %}