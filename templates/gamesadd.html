{% extends "adminlayout.html" %}

{% block main %}
<div class="container-fluid mt-4">
    <!-- Üst Kısım: Yemek Ekleme Formu -->
    <div class="row mb-4">
        <div class="col-md-12">
            <h3 class="text-center">Oyun Ekle</h3>
            <form action="/gamesadd" method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="gamename">Oyun İsmi</label>
                    <input type="text" class="form-control" id="gamename" name="gamename" placeholder="Oyun İsmi" required>
                </div>
                <div class="form-group">
                    <label for="gameImage">Oyun Resmi</label>
                    <input type="file" class="form-control" id="gameImage" name="gameImage" required>
                </div>
                <div class="form-group">
                    <label for="gameicon">Oyun Icon</label>
                    <input type="file" class="form-control" id="gameicon" name="gameicon" required>
                </div>
                <div class="form-group">
                    <label for="gametext">Açıklama</label>
                    <textarea class="form-control" id="gametext" name="gametext" rows="4" placeholder="Oyun Hakkında Bilgi" required></textarea>
                </div>
                <a class="btn btn-primary" onclick="addgame()">Oyun Ekle</a>
            </form>
        </div>
    </div>

    <!-- Alt Kısım: Kayıtlı Yemekler Tablosu -->
    <div class="row">
        <div class="col-md-12">
            <h3 class="text-center mb-4">Kayıtlı Oyunlar</h3>
            <table class="table table-bordered table-striped">
                <thead class="thead-dark">
                    <tr>
                        <th>Oyun ismi</th>
                        <th>Oyun Resim</th>
                        <th>Oyun İcon</th>
                        <th>Oyun Açıklama</th>
                    </tr>
                </thead>
                <tbody>
                    {% for game in games %}
                    <tr>
                        <td>{{ game.gamename }}</td>
                        <td>
                            <img src="{{ game.photopath }}" alt="{{game.gamename}} image" class="img-thumbnail" style="width: 100px; height: 100px;">
                        </td>
                        <td>
                            <img src="{{ game.iconpath }}" alt="{{game.gamename}} icon" class="img-thumbnail" style="width: 100px; height: 100px;">
                        </td>
                        <td>{{ game.text }}</td>
                        <td>
                            <a href="/updategame/{{game.id}}" class="btn btn-sm btn-primary"><i class="fa fa-pencil"></i>Düzenle</a>
                            <button type="button" class="btn btn-sm btn-danger" data-id="{{ game.id }}"  onclick="deletegame(this)"><i class="fa fa-trash"></i> Sil</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    let formData = new FormData();
    var gamename = document.getElementById("gamename");
    var gametext = document.getElementById("gametext");
    
    function addMedia() {
        var gameImage = document.getElementById('gameImage');
        var gameicon = document.getElementById('gameicon');
        var selectedImage = gameImage.files[0];
        var selectedicon = gameicon.files[0];

        if (selectedImage) {
            formData.append('image', selectedImage);
        }
        if (selectedicon) {
            formData.append('icon', selectedicon);
        }
    }
    function addgame()
    {
        formData.append('gamename', gamename.value);
        formData.append('gametext', gametext.value);
        addMedia();
        console.log(formData.get('gamename'))
        console.log(formData.get('gametext'))
        console.log(formData.get('image'))
        console.log(formData.get('icon'))
        $.ajax({
            url: "/gamesadd", 
            type: "POST",
            data: formData,
            processData: false,  // FormData kullanıldığı için veri işlenmez
            contentType: false,  // ContentType otomatik olarak ayarlanır
            success: function(response) {
                console.log("Başarıyla güncellendi: ", response.message);
                location.reload();
            },
            error: function(error) {
                console.log("Hata: ", error);
            }
        });
    }
    function deletegame(button)
    {
        let gameid = button.getAttribute('data-id');
        formData.append('gameid', gameid);
        console.log("Silinecek ID: ", gameid);
        $.ajax({
            url: "/deletegame", 
            type: "POST",
            data: formData,
            processData: false,  // FormData ile çalışırken bu iki ayarı false yap
            contentType: false,
            success: function(response) {
                console.log("Başarıyla güncellendi: ", response.message);
                location.reload();
            },
            error: function(error) {
                console.log("Hata: ", error);
            }
        });
    }
</script>
{% endblock %}
